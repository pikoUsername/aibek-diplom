{% extends "layout.html" %}
{% block content %}
<h2>Предсказание</h2>
{% if message %}
  <div class="alert alert-info">{{ message }}</div>
{% endif %}

<form method="POST" enctype="multipart/form-data" class="row g-3">
  <!-- CSV -->
  <div class="col-md-3">
    <label class="form-label">CSV-файл:</label>
    <select name="csv_filename" class="form-select" required>
      <option value="" disabled selected>-- выберите CSV --</option>
      {% for f in data_files %}
        <option value="{{ f }}">{{ f }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Скрипт -->
  <div class="col-md-3">
    <label class="form-label">Скрипт (опционально):</label>
    <select name="script_name" class="form-select">
      <option value="none" selected>-- без скрипта --</option>
      {% for sf in script_files %}
        <option value="{{ sf }}">{{ sf }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Столбцы -->
  <div class="col-md-3">
    <label class="form-label">Столбец даты:</label>
    <input type="text" name="date_col" class="form-control" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">Столбец-таргет:</label>
    <input type="text" name="target_col" class="form-control" required>
  </div>

  <!-- Модель -->
  <div class="col-md-3">
    <label class="form-label">Модель:</label>
    <select name="model_name" class="form-select" required>
      <option value="" disabled selected>-- выберите модель --</option>
      {% for mf in model_files %}
        <option value="{{ mf }}">{{ mf }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">Горизонт прогноза:</label>
    <input type="number" name="forecast_steps" class="form-control" value="14">
  </div>

  <!-- Новое поле для загрузки экзогенных переменных -->
  <div class="col-md-3">
    <label class="form-label">Файл с экзогенными данными (CSV):</label>
    <input type="file" name="exog_forecast_file" class="form-control">
  </div>

  <div class="col-12">
    <button type="submit" class="btn btn-primary">Предсказать</button>
  </div>
</form>

{% if plot_filename %}
  <hr>
  <h4>Результат</h4>
  <img src="{{ url_for('static', filename='plots/' + plot_filename) }}"
       class="img-fluid img-thumbnail" alt="Прогноз">
{% endif %}
{% endblock %}
